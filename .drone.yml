workspace:
  base: /go
  path: src/github.com/deis/prow
pipeline:
  test-unit:
    image: golang:1.8.0
    commands:
      - go get github.com/Masterminds/glide
      - make bootstrap build docker-binary
      - make test-unit
  publish-master:
    image: plugins/docker
    repo: quay.io/deis/prowd
    registry: quay.io
    username: ${DOCKER_USERNAME}
    password: ${DOCKER_PASSWORD}
    tag:
      - canary
    when:
      branch: master
      event: push
  publish-release:
    image: plugins/docker
    repo: quay.io/deis/prowd
    registry: quay.io
    username: ${DOCKER_USERNAME}
    password: ${DOCKER_PASSWORD}
    tag:
      - ${DRONE_TAG}
    when:
      event: tag
